(function(){window.App={Scenes:{Stage:{Labels:{},Background:{}}},Layers:{}}}).call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Layers.HelloWorld=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.size=cc.winSize,this.render_close_button(),this.render_hello_world_label(),this.render_hello_world_image()}return e(n,t),n.prototype.sprite=null,n.prototype.render_close_button=function(){var t,e,n;return e=function(){return cc.log("Menu is clicked!")},t=new cc.MenuItemImage(res.CloseNormal_png,res.CloseSelected_png,e,this),t.attr({x:this.size.width-20,y:20,anchorX:.5,anchorY:.5}),n=new cc.Menu(t),n.x=0,n.y=0,this.addChild(n,1)},n.prototype.render_hello_world_label=function(){var t;return t=new cc.LabelTTF("Hello World","Arial",38,{fillStyle:new cc.Color(0,0,0)}),t.x=this.size.width/2,t.y=0,this.addChild(t,5),t.runAction(cc.spawn(cc.moveBy(2.5,cc.p(0,this.size.height-40)),cc.tintTo(2.5,255,125,0)))},n.prototype.render_hello_world_image=function(){return this.sprite=new cc.Sprite(res.HelloWorld_png),this.sprite.attr({x:this.size.width/2,y:this.size.height/2,scale:.5,rotation:180}),this.addChild(this.sprite,0),this.sprite.runAction(cc.sequence(cc.rotateTo(2,0),cc.scaleTo(2,1,1)))},n}(cc.Layer)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.HelloWorld=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onEnter=function(){return n.__super__.onEnter.apply(this,arguments),this.addChild(new App.Layers.HelloWorld)},n}(cc.Scene)}.call(this),window.Backbone={},function(t){var e=[],n=(e.push,e.slice),r=(e.splice,t.Events={on:function(t,e,n){if(!i(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!i(this,"once",t,[e,n])||!e)return this;var r=this,o=_.once(function(){r.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var r,o,c,s,a,u,h,p;if(!this._events||!i(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(s=t?[t]:_.keys(this._events),a=0,u=s.length;u>a;a++)if(t=s[a],c=this._events[t]){if(this._events[t]=r=[],e||n)for(h=0,p=c.length;p>h;h++)o=c[h],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&r.push(o);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=n.call(arguments,1);if(!i(this,"trigger",t,e))return this;var r=this._events[t],o=this._events.all;return r&&c(r,e),o&&c(o,arguments),this},stopListening:function(t,e,n){var r=this._listeningTo;if(!r)return this;var o=!e&&!n;n||"object"!=typeof e||(n=this),t&&((r={})[t._listenId]=t);for(var i in r)t=r[i],t.off(e,n,this),(o||_.isEmpty(t._events))&&delete this._listeningTo[i];return this}}),o=/\s+/,i=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(o.test(n)){for(var c=n.split(o),s=0,a=c.length;a>s;s++)t[e].apply(t,[c[s]].concat(r));return!1}return!0},c=function(t,e){var n,r=-1,o=t.length,i=e[0],c=e[1],s=e[2];switch(e.length){case 0:for(;++r<o;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i);return;case 2:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,c);return;case 3:for(;++r<o;)(n=t[r]).callback.call(n.ctx,i,c,s);return;default:for(;++r<o;)(n=t[r]).callback.apply(n.ctx,e);return}},s={listenTo:"on",listenToOnce:"once"};_.each(s,function(t,e){r[e]=function(e,n,r){var o=this._listeningTo||(this._listeningTo={}),i=e._listenId||(e._listenId=_.uniqueId("l"));return o[i]=e,r||"object"!=typeof n||(r=this),e[t](n,r,this),this}}),r.bind=r.on,r.unbind=r.off,_.extend(t,r),_.extend(cc.Node.prototype,r)}(window.Backbone),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.BackgroundNode=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.size=cc.winSize,this._render_grass()}return e(n,t),n.prototype._render_grass=function(){return this.grass=new cc.Sprite(res.stage.backgrounds.grass),this.grass.attr({x:this.size.width/2,y:this.size.height/2}),this.addChild(this.grass)},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.BaseScene=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.size=cc.winSize,this.lines=[[],[],[],[],[],[]],this.lambs=[],this.touchables=[]}return e(n,t),n.prototype.lambs_count=5,n.prototype.patience_levels=_.range(7,20),n.prototype.current_score=0,n.prototype.y_lines=[0,100,200,280,360,440],n.prototype.zoom_lamb=function(t,e){var n,r,o,i,c,s;return window.last_lamb=t,n=t.getPosition(),r=t.getContentSize(),i=1.6+4*(1-2*t.lamb_node.getScaleY()),this.elements.setAnchorPoint(n.x/this.size.width,n.y/this.size.height),o=this.elements.getAnchorPointInPoints(),this.elements.setPosition(o.x,o.y),c=o.x-(o.x-this.size.width/2),s=o.y-(o.y-this.size.height/2)-r.height,this.elements.runAction(cc.sequence(cc.spawn(cc.EaseIn.create(cc.moveTo(.4,cc.p(c,s)),5),cc.EaseIn.create(cc.scaleTo(.4,i),5)),new cc.CallFunc(function(){return e()})))},n.prototype.stop_all_lambs=function(){return _(this.lambs).each(function(t){return t.stop()})},n.prototype._render_game_elements=function(){return this.elements=new cc.Node,this.elements.size=this.size,this.elements.attr({width:this.size.width,height:this.size.height}),this.elements.setAnchorPoint(0,0),this._render_background(),this.addChild(this.elements)},n.prototype._render_background=function(){return this.background=new App.Scenes.Stage.BackgroundNode,this.elements.addChild(this.background,0)},n.prototype._render_lambs=function(){return _(_.range(0,this.lambs_count)).each(function(t){return function(){return t.render_lamb(t._attributes_for_random_lamb())}}(this))},n.prototype.render_lamb=function(t){var e,n,r;return this.lines[t.line].push(1),n=parseInt(this.size.width*t.x),r=this.y_lines[t.line]+20+15*this.lines[t.line].length,e=new this.lamb_controller({scale:.5-r/this.size.height*.45,x:n,y:r,patience:t.patience,direction:t.direction,speed_per_sec:t.speed_per_sec,opacity:0,skin:t.skin,stage:this}),this.touchables.push(e),this.lambs.push(e),this.runAction(cc.sequence(new cc.DelayTime(t.delay),new cc.CallFunc(function(t){return function(){return t.elements.addChild(e,640+-1*r),e.dive(function(){return e.start()})}}(this)))),e},n.prototype._startEventListener=function(){return this.touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(t){return function(e){var n;return n=[],_(t.touchables).each(function(t){var r,o,i;return r=t.convertToNodeSpace(e.getLocation()),i=t.getContentSize(),o=cc.rect(0,0,i.width,i.height),cc.rectContainsPoint(o,r)?n.push(t):void 0}),n.length&&(e.touched_node=_(n).min(function(t){return t.getPosition().y})),e.touched_node?e.touched_node.onTouchBegan.apply(e.touched_node,arguments):void 0}}(this),onTouchMoved:function(){return function(t){return t.touched_node?t.touched_node.onTouchMoved.apply(t.touched_node,arguments):void 0}}(this),onTouchEnded:function(){return function(t){return t.touched_node?t.touched_node.onTouchEnded.apply(t.touched_node,arguments):void 0}}(this)}),cc.eventManager.addListener(this.touchListener,this)},n.prototype._attributes_for_random_lamb=function(){return{x:Math.random(),line:_(_.range(0,5)).sample(),patience:_(this.patience_levels).sample(),direction:_(["left","right"]).sample(),speed_per_sec:100+200*Math.random(),delay:Math.random()}},n}(cc.Scene)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.FingerNode=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.setAnchorPoint(.5,1),this.setContentSize(142,170),this._render_finger()}return e(n,t),n.prototype.start=function(){return this.setRotation(-10),this.finger.runAction(cc.spawn(cc.moveTo(.5,cc.p(0,0)),cc.fadeIn(.5),new cc.CallFunc(function(t){return function(){return t._run_circle_animation()}}(this))))},n.prototype.stop=function(){return this.stopAllActions(),this.runAction(cc.sequence(cc.scaleTo(.3,0),new cc.CallFunc(function(t){return function(){return t.parent.removeChild(t,!0)}}(this))))},n.prototype._render_finger=function(){return this.finger=new cc.Sprite(res.stage.lamb,new cc.Rect(560,330,142,170)),this.finger.setAnchorPoint(0,0),this.finger.attr({x:0,y:-60,opacity:0}),this.addChild(this.finger,1)},n.prototype._run_circle_animation=function(){return this.runAction(new cc.RepeatForever(cc.sequence(new cc.CallFunc(function(t){return function(){return t._render_circle()}}(this)),new cc.DelayTime(.5))))},n.prototype._render_circle=function(){var t;return t=new cc.Sprite(res.stage.lamb,new cc.Rect(735,358,142,142)),t.setAnchorPoint(.5,.5),t.attr({x:56,y:160,opacity:0,scale:.3}),this.addChild(t,0),t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.5,.9),cc.fadeIn(.5)),cc.spawn(cc.scaleTo(.5,1.5),cc.fadeOut(.5)),new cc.CallFunc(function(e){return function(){return e.removeChild(t,!0)}}(this))))},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.Labels.NumbersNode=function(t){function n(t){null==t&&(t={}),n.__super__.constructor.apply(this,arguments),this.update(t.numbers,t)}return e(n,t),n.prototype.update=function(t,e){var n;switch(null==e&&(e={}),this.clear(),n=_(t.toString()).toArray(),this.number_nodes=[],this.align=e.align||this.align||"left",this.align){case"right":this.setAnchorPoint(1,0),this.start_point=-70*n.length;break;case"left":this.setAnchorPoint(0,0),this.start_point=0;break;case"center":this.setAnchorPoint(.5,0),this.start_point=-70*n.length/2+10}return _(n).each(function(t){return function(e,n){var r;return r=t._render_number(e,n),t.number_nodes.push(r),t.addChild(r)}}(this))},n.prototype.clear=function(){return this.removeAllChildrenWithCleanup(!0)},n.prototype.setOpacity=function(t){return _(this.number_nodes).each(function(e){return e.setOpacity(t)})},n.prototype._render_number=function(t,e){var n,r;return r=80*parseInt(t),n=new cc.Sprite(res.stage.labels.numbers,new cc.Rect(r,0,80,150)),n.setAnchorPoint(0,0),n.attr({x:this.start_point+70*e}),n},n.prototype.fade_in_then_out=function(t){var e,n,r;return n=cc.spawn(cc.fadeIn(.3),cc.moveBy(.3,cc.p(0,80))),r=cc.spawn(cc.fadeOut(.3),cc.moveBy(.3,cc.p(0,80))),e=new cc.CallFunc(function(){return t()}),_(this.number_nodes).each(function(t){return t.setOpacity(0),t.runAction(cc.sequence(n.clone(),r.clone(),e))})},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.LambController=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.stage=t.stage,this.skin=t.skin||"mine",this.setAnchorPoint(.5,0),this.options=t||{},this.patience=t.patience,this.speed_per_sec=t.speed_per_sec,this.lamb_node=new App.Scenes.Stage.LambNode({skin:this.skins[this.skin]}),this.gauge_node=new App.Scenes.Stage.GaugeNode,this.addChild(this.lamb_node,1),this.addChild(this.gauge_node,2),this.main_node=this.lamb_node,this.on("time-over",function(t){return function(){return t.stage.trigger("time-over",t)}}(this))}return e(n,t),n.prototype.speed_per_sec=180,n.prototype.speaking=!1,n.prototype.walking=!1,n.prototype.moving=!1,n.prototype.active=!0,n.prototype.direction="right",n.prototype.skins={mine:res.stage.lamb,enermy:res.stage.enermy_lamb},n.prototype.events={},n.prototype.onEnter=function(){return this._set_scale(),this._set_position(),this.lamb_node.attr({y:700}),this.gauge_node.runAction(cc.hide()),n.__super__.onEnter.apply(this,arguments)},n.prototype.start=function(){return this.gauge_node.runAction(cc.sequence(cc.show())),this.gauge_node.start(),this.move_around(0,this.stage.size.width),this._start_time=(new Date).getTime()},n.prototype.stop=function(){return this.active=!1,this.stopAllActions(),this.lamb_node.stop(),this.gauge_node.stop(),this.gauge_node.runAction(cc.hide())},n.prototype.reset=function(t){return this._start_time=(new Date).getTime(),this.patience=t.patience,this.gauge_node.reset()},n.prototype._render_score_overlay=function(t){var e,n,r;return r=this.getContentSize(),n=new App.Scenes.Stage.Labels.NumbersNode({numbers:t,align:"center"}),e=.2,t>15&&(e=.3),t>30&&(e=.5),n.attr({x:r.width/2,y:r.height,scale:e}),n.fade_in_then_out(function(t){return function(){return t.removeChild(n,!0)}}(this)),this.addChild(n,20)},n.prototype.move=function(t){var e,n;return this.moving&&this.stopAction(this.moving),e=t/this.speed_per_sec,n=new cc.CallFunc(function(t){return function(){return t.stand()}}(this)),this.moving=cc.sequence(cc.moveBy(e,cc.p(t,0)),n),this.runAction(this.moving)},n.prototype.move_around=function(t,e){var n,r,o,i,c,s,a,u;if(this.moving)return!1;switch(s=this.getPosition(),t<this.minimum&&(t=this.minimum),e>this.maximum&&(e=this.maximum),o=e-t,a=o/this.speed_per_sec,r=cc.sequence(this._turn_to_left(),cc.moveTo(a,cc.p(t,s.y)),this._turn_to_right(),cc.moveTo(a,cc.p(e,s.y))),n=new cc.CallFunc(function(t){return function(){return t.runAction(new cc.RepeatForever(r))}}(this)),this.direction){case"right":u=e-s.x,c=cc.sequence(cc.moveTo(u/this.speed_per_sec,cc.p(e,s.y)),n);break;case"left":i=s.x-t,c=cc.sequence(cc.moveTo(i/this.speed_per_sec,cc.p(t,s.y)),this._turn_to_right(),cc.moveTo((e-t)/this.speed_per_sec,cc.p(e,s.y)),n)}return this.runAction(c),this.walk(),this.moving=!0},n.prototype.walk=function(){var t,e,n;return this.walking?void 0:(n=.6,this.walking=!0,t=new cc.RepeatForever(cc.sequence(cc.rotateTo(n,70),cc.rotateTo(n,110))),e=new cc.RepeatForever(cc.sequence(cc.rotateTo(n,110),cc.rotateTo(n,70))),this.lamb_node.legs[0].runAction(t.clone()),this.lamb_node.legs[1].runAction(e.clone()),this.lamb_node.legs[2].runAction(t.clone()),this.lamb_node.legs[3].runAction(e.clone()))},n.prototype.stand=function(){return this.moving=!1,this.walking=!1,_(this.lamb_node.legs).each(function(){return function(t){return t.stopAllActions(),t.runAction(cc.sequence(cc.rotateTo(.6,90)))}}(this))},n.prototype.speak=function(){var t;return this.speaking?void 0:(this.speaking=!0,this.lamb_node.face.setTextureRect(new cc.Rect(891,200,99,74)),t=cc.audioEngine.playEffect(res.audio.baaa,!1),setTimeout(function(){return function(){return cc.audioEngine.stopEffect(t)}}(this),3e3))},n.prototype.die=function(t){return this.stop(),this.gauge_node.runAction(cc.sequence(cc.hide())),this.lamb_node.runAction(cc.sequence(cc.EaseIn.create(cc.scaleTo(.8,0),2))),this.lamb_node.shadow.runAction(cc.sequence(cc.EaseIn.create(cc.scaleTo(.8,0),2),new cc.CallFunc(function(e){return function(){return e.parent.removeChild(e,!0),t instanceof Function?t():void 0}}(this))))},n.prototype.dive=function(t){var e;return this.set_direction(this.options.direction),e=this.lamb_node.shadow,this.lamb_node.removeChild(e,!1),e.setAnchorPoint(.5,.5),e.attr({x:250*this.options.scale,y:10*this.options.scale,scale:0}),this.addChild(e),this.lamb_node.attr({y:700}),this.lamb_node.runAction(cc.sequence(cc.EaseBounceOut.create(cc.moveTo(1.4,cc.p(this.lamb_node.getPosition().x,0)),0))),this.lamb_node.shadow.runAction(cc.sequence(cc.EaseBounceOut.create(cc.scaleTo(1.4,this.options.scale),0),new cc.CallFunc(function(){return function(){return t()}}(this))))},n.prototype.set_direction=function(t){var e,n;return n=this.lamb_node.getScaleX(),t||(t=_(["left","right"]).sample()),e=n>0?"right":"left",e!==t&&this.lamb_node.setScaleX(-1*n),this.direction=t},n.prototype._turn_to_right=function(){return new cc.CallFunc(function(t){return function(){return t.set_direction("right")}}(this))},n.prototype._turn_to_left=function(){return new cc.CallFunc(function(t){return function(){return t.set_direction("left")}}(this))},n.prototype._set_scale=function(){var t,e;return this.speed_per_sec=this.speed_per_sec*this.options.scale,this.lamb_node.setScale(this.options.scale),e=parseInt(this.lamb_node.getContentSize().width*this.options.scale),t=parseInt(this.lamb_node.getContentSize().height*this.options.scale),this.setContentSize(e,t),this.lamb_node.setPosition(e/2,0)},n.prototype._set_position=function(){var t,e;return e=this.getContentSize(),t=e.width/2,this.minimum=t,this.maximum=this.stage.size.width-t,this.options.x>this.maximum&&(this.options.x=this.maximum),this.options.x<this.minimum&&(this.options.x=this.minimum),this.setPosition(this.options.x,this.options.y)},n.prototype.onTouchBegan=function(){return this[this.events.touchstart]instanceof Function?this[this.events.touchstart].apply(this,arguments):!0},n.prototype.onTouchMoved=function(){return this[this.events.touchmove]instanceof Function?this[this.events.touchmove].apply(this,arguments):void 0},n.prototype.onTouchEnded=function(){return this[this.events.touchend]instanceof Function?this[this.events.touchend].apply(this,arguments):void 0},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.GaugeNode=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.setAnchorPoint(.5,0),this.setContentSize(200,18),this.setPosition(50,0),this.setScale(.4),this._render_background(),this._render_bar()}return e(n,t),n.prototype.onEnter=function(){return n.__super__.onEnter.apply(this,arguments),this._set_position()},n.prototype.start=function(){return this.bar.runAction(this._create_gauge_animation())},n.prototype.reset=function(){return this.bar.stopAllActions(),this.bar.setScaleX(0),this.bar.runAction(this._create_gauge_animation())},n.prototype.stop=function(){return this.bar.stopAllActions()},n.prototype._create_gauge_animation=function(){return cc.sequence(cc.scaleTo(this.parent.patience,1,1),new cc.CallFunc(function(t){return function(){return t.parent.trigger("time-over")}}(this)))},n.prototype._create_sprite=function(t,e,n,r){var o;return o=new cc.Sprite(res.stage.lamb,new cc.Rect(t,e,n,r)),o.setAnchorPoint(0,0),o},n.prototype._render_bar=function(){return this.bar=this._create_sprite(540,300,200,18),this.bar.setScaleX(0),this.addChild(this.bar,1)},n.prototype._render_background=function(){return this.background=this._create_sprite(740,300,200,18),this.addChild(this.background,0)},n.prototype._set_position=function(){var t,e,n;return t=this.parent.getContentSize(),e=t.width/2,n=t.height+20,this.setPosition(e,n)},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.LambNode=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.skin=t.skin||res.stage.lamb,this.setAnchorPoint(.5,0),this.setContentSize(540,396),this._render_body(),this._render_face(),this._render_legs(),this._render_shadow()}return e(n,t),n.prototype.stop=function(){return _(this.legs).each(function(t){return t.stopAllActions()})},n.prototype._create_sprite=function(t,e,n,r){var o;return o=new cc.Sprite(this.skin,new cc.Rect(t,e,n,r)),o.setAnchorPoint(0,0),o},n.prototype._render_body=function(){return this.front_body=this._create_sprite(0,0,540,326),this.front_body.attr({x:0,y:70}),this.back_body=this._create_sprite(541,0,450,188),this.back_body.attr({x:30,y:55}),this.addChild(this.front_body,10),this.addChild(this.back_body,0)},n.prototype._render_legs=function(){return this.legs=[],_(_.range(0,4)).each(function(t){return function(e,n){var r;return r=t._create_sprite(540,189,228,44),r.attr({y:-30}),r.setAnchorPoint(.09,.5),t.addChild(r,9-n),t.legs.push(r)}}(this)),this.legs[0].attr({x:360,y:210,rotation:90}),this.legs[1].attr({x:420,y:210,rotation:90}),this.legs[2].attr({x:90,y:210,rotation:90}),this.legs[3].attr({x:150,y:210,rotation:90})},n.prototype._render_face=function(){return this.face=this._create_sprite(780,200,99,74),this.face.attr({x:400,y:250}),this.addChild(this.face,11)},n.prototype._render_shadow=function(){return this.shadow=this._create_sprite(0,340,540,80),this.shadow.attr({y:-30}),this.addChild(this.shadow,0)},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.PVPLambController=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={touchstart:"send_touch_to_server"},n.prototype.send_touch_to_server=function(){return $socket.emit("touch-lamb",{id:this._pvp_lamb_id})},n}(App.Scenes.Stage.LambController)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.ScoreLambController=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={touchstart:"earn_score"},n.prototype.earn_score=function(){var t,e,n,r,o,i;return cc.audioEngine.playEffect(res.audio.tap,!1),this.active?(t=(new Date).getTime(),o=parseInt((t-this._start_time)/1e3*100)/100,e=this.patience-o,i=1.6*this.patience,e<this.patience/10?n=2*i:(r=1.6*e,n=i-r),o>e&&(this.stage.trigger("score-earned",parseInt(n)),this._render_score_overlay(parseInt(n))),this.reset({patience:_(this.stage.patience_levels).sample()})):void 0},n}(App.Scenes.Stage.LambController)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.PVPLabelsNode=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onEnter=function(){return n.__super__.onEnter.apply(this,arguments),this._render_won_image(),this._render_lost_image(),this._render_back_button(),this._render_restart_button()},n.prototype.active_pvp_won=function(){return this.won_image.runAction(cc.sequence(new cc.DelayTime(.5),cc.fadeIn(.4))),this.active_restart_button()},n.prototype.active_pvp_lost=function(){return this.lost_image.runAction(cc.sequence(new cc.DelayTime(.5),cc.fadeIn(.4))),this.active_restart_button()},n.prototype._render_won_image=function(){return this.won_image=new cc.Sprite(res.ending,new cc.Rect(0,130,1136,120)),this.won_image.setAnchorPoint(0,0),this.won_image.attr({x:0,y:240,opacity:0}),this.addChild(this.won_image)},n.prototype._render_lost_image=function(){return this.lost_image=new cc.Sprite(res.ending,new cc.Rect(0,0,1136,120)),this.lost_image.setAnchorPoint(0,0),this.lost_image.attr({x:0,y:240,opacity:0}),this.addChild(this.lost_image)},n.prototype.active_restart_button=function(){return this.restart_button.runAction(cc.sequence(new cc.DelayTime(.5),cc.fadeIn(.4),new cc.CallFunc(function(t){return function(){return t.parent.touchables=[t.restart_button,t.back_button]}}(this))))},n.prototype._render_back_button=function(){return this.back_button=new cc.Sprite(res.stage.lamb,new cc.Rect(0,430,110,106)),this.back_button.setAnchorPoint(0,0),this.back_button.attr({x:10,y:550,scale:.7}),this.addChild(this.back_button),this.parent.touchables.push(this.back_button),this.back_button.onTouchBegan=function(){return function(){return $socket.emit("left-room"),cc.director.runScene(cc.TransitionFade.create(1,new App.Scenes.LandingScene,new cc.Color(0,0,0))),!1}}(this)},n.prototype._render_restart_button=function(){return this.restart_button=new cc.Sprite(res.stage.lamb,new cc.Rect(110,430,110,106)),this.restart_button.setAnchorPoint(.5,0),this.restart_button.attr({x:cc.winSize.width/2,y:60,opacity:0}),this.addChild(this.restart_button),this.restart_button.onTouchBegan=function(){return function(){return $socket.emit("restart-pvp"),!1}}(this)},n}(cc.Node)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.Stage.ScoreModelLabelsNode=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onEnter=function(){return n.__super__.onEnter.apply(this,arguments),this._render_current_score(),this._render_back_button(),this._render_restart_button(),this._render_lost_image()},n.prototype._render_current_score=function(){return this.score_label=new App.Scenes.Stage.Labels.NumbersNode({numbers:0,align:"right"}),this.score_label.attr({x:cc.winSize.width-20,y:550,scale:.6}),this.addChild(this.score_label)},n.prototype._render_restart_button=function(){return this.restart_button=new cc.Sprite(res.stage.lamb,new cc.Rect(110,430,110,106)),this.restart_button.setAnchorPoint(.5,0),this.restart_button.attr({x:cc.winSize.width/2,y:60,opacity:0}),this.addChild(this.restart_button),this.restart_button.onTouchBegan=function(){return function(){return cc.director.runScene(cc.TransitionFade.create(1,new App.Scenes.ScoreStageScene({had_tutorial:!0}),new cc.Color(0,0,0)))}}(this)},n.prototype._render_lost_image=function(){return this.lost_image=new cc.Sprite(res.ending,new cc.Rect(0,0,1136,120)),this.lost_image.setAnchorPoint(0,0),this.lost_image.attr({x:0,y:240,opacity:0}),this.addChild(this.lost_image)},n.prototype.active_restart_button=function(){return this.lost_image.runAction(cc.sequence(new cc.DelayTime(.5),cc.fadeIn(.4))),this.restart_button.runAction(cc.sequence(new cc.DelayTime(.5),cc.fadeIn(.4),new cc.CallFunc(function(t){return function(){return t.parent.touchables=[t.restart_button,t.back_button]}}(this))))},n.prototype._render_back_button=function(){return this.back_button=new cc.Sprite(res.stage.lamb,new cc.Rect(0,430,110,106)),this.back_button.setAnchorPoint(0,0),this.back_button.attr({x:10,y:550,scale:.7}),this.addChild(this.back_button),this.parent.touchables.push(this.back_button),this.back_button.onTouchBegan=function(){return function(){return cc.director.runScene(cc.TransitionFade.create(1,new App.Scenes.LandingScene,new cc.Color(0,0,0)))}}(this)},n}(cc.Node)}.call(this),function(){}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.LandingScene=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.animation_speed=1,n.prototype.onEnter=function(){return n.__super__.onEnter.apply(this,arguments),this.size=cc.winSize,this.touchables=[],this._render_lamb_face(),this._render_title(),this._render_menus(),this._render_copyright(),this._render_common_cc(),this._startEventListener()},n.prototype._render_lamb_face=function(){return this.lamb_face=new cc.Sprite(res.landing.background),this.lamb_face.attr({x:this.size.width/2,y:this.size.height/2,opacity:0}),this.addChild(this.lamb_face),this.lamb_face.runAction(cc.sequence(cc.fadeIn(this.ani_speed(1.6),3)))},n.prototype._render_title=function(){return this.title=this._create_sprite(0,0,416,20),this.title.attr({x:this.size.width/2,y:200,opacity:0,scale:1.2}),this.title.setAnchorPoint(.5,0),this.addChild(this.title),this.title.runAction(cc.sequence(new cc.DelayTime(this.ani_speed(1.6)),cc.spawn(cc.fadeIn(this.ani_speed(1),3),cc.scaleTo(this.ani_speed(1),1))))},n.prototype._render_menus=function(){return this.score_button=this._create_sprite(0,68,396,88),this.pvp_button=this._create_sprite(400,68,396,88),this.score_button.attr({opacity:0,x:this.size.width/2-410,y:70}),this.pvp_button.attr({opacity:0,x:this.size.width/2+14,y:70}),this.addChild(this.score_button),this.addChild(this.pvp_button),this.score_button.runAction(cc.sequence(new cc.DelayTime(this.ani_speed(3)),cc.spawn(cc.fadeIn(this.ani_speed(1),3)))),this.pvp_button.runAction(cc.sequence(new cc.DelayTime(this.ani_speed(3.4)),cc.spawn(cc.fadeIn(this.ani_speed(1),3)))),this.touchables.push(this.score_button),this.touchables.push(this.pvp_button),this.score_button.onTouchBegan=function(){return function(){return cc.director.runScene(cc.TransitionFade.create(1,new App.Scenes.ScoreStageScene,new cc.Color(0,0,0)))}}(this),this.pvp_button.onTouchBegan=function(){return function(){return $socket.emit("create-room"),!1}}(this)},n.prototype._render_copyright=function(){return this.copyright=this._create_sprite(2,39,300,14),this.copyright.attr({x:this.size.width/2-150,y:20,opacity:0}),this.addChild(this.copyright),this.copyright.runAction(cc.sequence(new cc.DelayTime(this.ani_speed(3.8)),cc.spawn(cc.fadeIn(this.ani_speed(1),3))))},n.prototype._render_common_cc=function(){return this.common_cc=this._create_sprite(440,0,126,40),this.common_cc.attr({x:this.size.width-136,y:10,opacity:0}),this.addChild(this.common_cc),this.common_cc.runAction(cc.sequence(new cc.DelayTime(this.ani_speed(4.1)),cc.spawn(cc.fadeIn(this.ani_speed(1),3))))},n.prototype._create_sprite=function(t,e,n,r){var o;return o=new cc.Sprite(res.landing.sprite,new cc.Rect(t,e,n,r)),o.setAnchorPoint(0,0),o},n.prototype._startEventListener=function(){return this.touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(t){return function(e){var n;return n=[],_(t.touchables).each(function(t){var r,o,i;return r=t.convertToNodeSpace(e.getLocation()),i=t.getContentSize(),o=cc.rect(0,0,i.width,i.height),cc.rectContainsPoint(o,r)?n.push(t):void 0}),n.length&&(e.touched_node=_(n).min(function(t){return t.getPosition().y})),e.touched_node?e.touched_node.onTouchBegan.apply(e.touched_node,arguments):void 0}}(this),onTouchMoved:function(){return function(t){return t.touched_node?t.touched_node.onTouchMoved.apply(t.touched_node,arguments):void 0}}(this),onTouchEnded:function(){return function(t){return t.touched_node?t.touched_node.onTouchEnded.apply(t.touched_node,arguments):void 0}}(this)}),cc.eventManager.addListener(this.touchListener,this)},n.prototype.ani_speed=function(t){return t*this.animation_speed},n}(cc.Scene)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.PVPLandingScene=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.touchables=[],this.size=cc.winSize,this.options=t,this._render_background(),this._render_title(),this._render_button(),this._render_room_id(),this._render_back_button(),this._startEventListener()}return e(n,t),n.prototype._render_background=function(){return this.background=new cc.Sprite(res.pvp_landing.background),this.background.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.background)},n.prototype._render_title=function(){return this.title=new cc.Sprite(res.pvp_landing.sprite,new cc.Rect(0,0,532,48)),this.title.attr({x:this.size.width/2,y:490}),this.title.setAnchorPoint(.5,0),this.addChild(this.title),this.title.runAction(new cc.RepeatForever(cc.sequence(cc.fadeTo(.5,0),cc.fadeTo(.5,255))))},n.prototype._render_button=function(){return this.button=new cc.Sprite(res.pvp_landing.sprite,new cc.Rect(2,51,396,88)),this.button.attr({x:this.size.width/2,y:80}),this.button.setAnchorPoint(.5,0),this.addChild(this.button),this.touchables.push(this.button),this.button.onTouchBegan=function(t){return function(){var e;return e=prompt("Please provide 5 digits number:"),e===t.options.room_id?alert("That's your room number."):e?$socket.emit("join-room",{room_id:e}):alert("Please put a room number."),!1}}(this)},n.prototype._render_room_id=function(){return this.numbers=[],_(this.options.room_id.toString()).each(function(t){return function(e,n){return e=new cc.LabelTTF(e,"Arial",110),e.setAnchorPoint(.5,.5),e.attr({x:288+140*n,y:324,fillStyle:new cc.Color(0,0,0)}),t.addChild(e),t.numbers.push(e)
}}(this))},n.prototype._startEventListener=function(){return this.touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(t){return function(e){var n;return n=[],_(t.touchables).each(function(t){var r,o,i;return r=t.convertToNodeSpace(e.getLocation()),i=t.getContentSize(),o=cc.rect(0,0,i.width,i.height),cc.rectContainsPoint(o,r)?n.push(t):void 0}),n.length&&(e.touched_node=_(n).min(function(t){return t.getPosition().y})),e.touched_node?e.touched_node.onTouchBegan.apply(e.touched_node,arguments):void 0}}(this),onTouchMoved:function(){return function(t){return t.touched_node?t.touched_node.onTouchMoved.apply(t.touched_node,arguments):void 0}}(this),onTouchEnded:function(){return function(t){return t.touched_node?t.touched_node.onTouchEnded.apply(t.touched_node,arguments):void 0}}(this)}),cc.eventManager.addListener(this.touchListener,this)},n.prototype._render_back_button=function(){return this.back_button=new cc.Sprite(res.stage.lamb,new cc.Rect(0,430,110,106)),this.back_button.setAnchorPoint(0,0),this.back_button.attr({x:10,y:550,scale:.7}),this.addChild(this.back_button),this.touchables.push(this.back_button),this.back_button.onTouchBegan=function(){return function(){return cc.director.runScene(cc.TransitionFade.create(1,new App.Scenes.LandingScene,new cc.Color(0,0,0)))}}(this)},n}(cc.Scene)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.PVPStageScene=function(t){function n(t){n.__super__.constructor.apply(this,arguments),$socket._pvp_stage_scene=this,this.options=t,this._render_game_elements(),this._render_game_overlays(),this._render_lambs(),this._set_events(),this._startEventListener()}return e(n,t),n.prototype.lamb_controller=App.Scenes.Stage.PVPLambController,n.prototype.add_lamb=function(t){var e;return t.owner_id!==$socket._pvp_id&&(t.skin="enermy"),e=this.render_lamb(t),e._pvp_lamb_id=t.id,this._lambs_by_id[t.id]=e},n.prototype._render_game_overlays=function(){return this.labels=new App.Scenes.Stage.PVPLabelsNode,this.labels.attr({x:0,y:0,width:this.size.width,height:this.size.height}),this.addChild(this.labels,700)},n.prototype._render_lambs=function(){return this._lambs_by_id={},_(this.options.lambs).each(function(t){return function(e){return t.add_lamb(e)}}(this))},n.prototype._set_events=function(){return this.on("pvp-won",function(t){return function(e){return t.stop_all_lambs(),t.zoom_lamb(e,function(){return e.speak(),t.labels.active_pvp_won()})}}(this)),this.on("pvp-lost",function(t){return function(e){return t.stop_all_lambs(),t.zoom_lamb(e,function(){return e.speak(),t.labels.active_pvp_lost()})}}(this))},n.prototype.get_lamb=function(t){return this._lambs_by_id[t]},n}(App.Scenes.Stage.BaseScene)}.call(this),function(){}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};App.Scenes.ScoreStageScene=function(t){function n(t){null==t&&(t={}),this.options=t,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.lamb_controller=App.Scenes.Stage.ScoreLambController,n.prototype.onEnter=function(){return n.__super__.onEnter.apply(this,arguments),this._render_game_elements(),this._start_tutorial(function(t){return function(){return t._start_score_mode()}}(this)),this._startEventListener()},n.prototype._start_tutorial=function(t){var e,n,r;return this.options.had_tutorial?t():(r=new this.lamb_controller({scale:.8,x:this.size.width/2,y:120,patience:5,direction:"right",stage:this}),n=new App.Scenes.Stage.FingerNode,e=new cc.Sprite(res.stage.lamb,new cc.Rect(840,330,40,18)),e.attr({scale:1.5,x:120,y:47}),r.gauge_node.addChild(e),this.runAction(cc.sequence(new cc.DelayTime(1),new cc.CallFunc(function(t){return function(){return t.elements.addChild(r),r.dive(function(){return r._start_time=(new Date).getTime(),r.gauge_node.runAction(cc.show()),r.gauge_node.start()})}}(this)))),this.runAction(cc.sequence(new cc.DelayTime(5),new cc.CallFunc(function(t){return function(){return n.attr({x:t.size.width/2+140,y:220}),t.addChild(n),n.start(),t.touchables.push(r)}}(this)))),this.once("score-earned",function(e){return function(){return n.stop(),r.die(function(){return e.touchables.length=0,t()})}}(this)))},n.prototype._start_score_mode=function(){return this._render_game_overlays(),this._render_lambs(),this.score_earned=0,this.on("time-over",function(t){return function(e){return cc.audioEngine.stopMusic(),t.stop_all_lambs(),t.zoom_lamb(e,function(){return t.labels.active_restart_button(),e.speak()})}}(this)),this.on("score-earned",function(t){return function(e){return t.score_earned++,t.current_score+=e,t.labels.score_label.update(t.current_score),t.score_earned%5===0?t.render_lamb(t._attributes_for_random_lamb()):void 0}}(this))},n.prototype._render_game_overlays=function(){return this.labels=new App.Scenes.Stage.ScoreModelLabelsNode,this.labels.attr({x:0,y:0,width:this.size.width,height:this.size.height}),this.addChild(this.labels,700)},n}(App.Scenes.Stage.BaseScene)}.call(this);